# OTA Package Metadata Specification

**í”„ë¡œì íŠ¸**: OTA-Zonal_Gateway (TC375 Lite Kit)  
**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01-13  

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ê³„ì¸µì  íŒ¨í‚¤ì§€ êµ¬ì¡°](#ê³„ì¸µì -íŒ¨í‚¤ì§€-êµ¬ì¡°)
3. [Level 3-1: Vehicle Package Metadata](#level-3-1-vehicle-package-metadata)
4. [Level 3-2: Zone Package Metadata](#level-3-2-zone-package-metadata)
5. [Level 3-3: ECU Package Metadata](#level-3-3-ecu-package-metadata)
6. [Level 4: Readiness Metadata](#level-4-readiness-metadata)
7. [Package Generation Flow](#package-generation-flow)
8. [OTA Deployment Sequence](#ota-deployment-sequence)

---

## ê°œìš”

### OTA Package Metadataë€?

OTA (Over-The-Air) íŒ¨í‚¤ì§€ì˜ **ì‹ë³„**, **ê²€ì¦**, **ì„¤ì¹˜**ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ë©”íƒ€ë°ì´í„°ì…ë‹ˆë‹¤.

### ì„¤ê³„ ì›ì¹™

1. **ê³„ì¸µì  êµ¬ì¡°**: Vehicle â†’ Zone â†’ ECU 3ë‹¨ê³„ ê³„ì¸µ
2. **ë…ë¦½ì„±**: ê° Zoneì€ ë…ë¦½ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë° Rollback ê°€ëŠ¥
3. **í™•ì¥ì„±**: Add-on ëª¨ë“ˆ ì§€ì›, Zone ì¶”ê°€/ì‚­ì œ ìš©ì´
4. **ë³´ì•ˆ**: Magic Number, CRC32, Digital Signature
5. **í‘œì¤€ ì¤€ìˆ˜**: ISO 14229 (UDS), ISO 13400 (DoIP) ê¸°ë°˜

---

## ê³„ì¸µì  íŒ¨í‚¤ì§€ êµ¬ì¡°

### ì „ì²´ êµ¬ì¡° ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3-1: Vehicle Package (Master Package)                â”‚
â”‚  â”œâ”€ Vehicle Metadata (~690 bytes)                           â”‚
â”‚  â”œâ”€ Zone Package 1                                          â”‚
â”‚  â”œâ”€ Zone Package 2                                          â”‚
â”‚  â””â”€ Zone Package N                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3-2: Zone Package (per Zone)                         â”‚
â”‚  â”œâ”€ Zone Metadata (~800 bytes)                              â”‚
â”‚  â”œâ”€ ECU Package 1                                           â”‚
â”‚  â”œâ”€ ECU Package 2                                           â”‚
â”‚  â””â”€ ECU Package N                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3-3: ECU Package (per ECU)                           â”‚
â”‚  â”œâ”€ ECU Metadata (~512 bytes)                               â”‚
â”‚  â”œâ”€ Main SW Binary                                          â”‚
â”‚  â””â”€ Add-on Module Binaries (optional)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 4: Readiness Metadata (Runtime)                      â”‚
â”‚  â”œâ”€ Readiness Info (~27 bytes)                              â”‚
â”‚  â”œâ”€ Pre-OTA validation                                      â”‚
â”‚  â””â”€ Collected via UDP Broadcast                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ê³„ì¸µë³„ ì—­í• 

| Level | íŒ¨í‚¤ì§€ íƒ€ì… | ìƒì„± ì£¼ì²´ | ì €ì¥ ìœ„ì¹˜ | ëª©ì  |
|-------|------------|----------|----------|------|
| **3-1** | Vehicle Package | Vehicle Integration Team | VMG Server | ì „ì²´ ì°¨ëŸ‰ OTA íŒ¨í‚¤ì§€ |
| **3-2** | Zone Package | Zone Integration Team | Embedded in Vehicle Pkg | Zoneë³„ ë…ë¦½ ì—…ë°ì´íŠ¸ |
| **3-3** | ECU Package | ECU Development Team | Embedded in Zone Pkg | ECU SW + Add-ons |
| **4** | Readiness | Runtime (ZGW) | RAM (temporary) | ì‚¬ì „ ê²€ì¦ |

---

## Level 3-1: Vehicle Package Metadata

### ê°œë…

VMG ì„œë²„ì—ì„œ ìƒì„±í•˜ëŠ” **ìµœìƒìœ„ ë§ˆìŠ¤í„° íŒ¨í‚¤ì§€**ë¡œ, ì „ì²´ ì°¨ëŸ‰ì˜ OTA ì—…ë°ì´íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

```c
/**
 * \brief Vehicle Package Metadata
 * 
 * Master package containing zone-specific sub-packages
 * Generated by: VMG Server (Vehicle Integration Team)
 * Storage: VMG Server, transmitted to ZGW
 */
typedef struct
{
    /* Package Identification */
    uint32 magic_number;             /* Magic: 0x5650434B ("VPCK") */
    uint16 metadata_version;         /* Metadata structure version */
    uint16 metadata_size;            /* Size of this structure */
    
    /* Package Information */
    char package_id[32];             /* Unique Package ID (e.g., "VPKG_2024_001") */
    char vehicle_sw_version[16];     /* Master SW Version (e.g., "2.5.0") */
    uint32 package_total_size;       /* Total package size (bytes) */
    uint32 package_crc32;            /* CRC32 of entire package */
    uint32 creation_timestamp;       /* Package creation time (Unix timestamp) */
    
    /* Target Vehicle Identification (matches Vehicle-Level VCI) */
    char target_vin[18];             /* Specific VIN (must match Vehicle VCI) */
    char target_vehicle_model[32];   /* Target Model (must match Vehicle VCI) */
    uint16 target_model_year;        /* Target Model Year (0=any) */
    
    /* Compatibility Criteria */
    uint16 target_model_years[8];    /* Applicable model years (0=unused) */
    uint8 target_vehicle_types[8];   /* Applicable vehicle types (0=unused) */
    uint8 target_regions[8];         /* Applicable regions (0=unused) */
    char min_vehicle_sw_version[16]; /* Minimum current vehicle SW version */
    uint8 required_architecture;     /* Required: NETWORK_ARCH_ZONAL (0x02) */
    uint8 required_num_zones;        /* Required number of zones (must match VCI) */
    
    /* Zone Package Information */
    uint8 number_of_zones;           /* Number of zones to update (1-8) */
    struct {
        uint8 zone_id;               /* Zone ID (1-7, 0=Central) */
        char zone_package_id[32];    /* Sub-package ID (e.g., "ZPKG_Z1_001") */
        uint32 zone_package_offset;  /* Offset in vehicle package (bytes) */
        uint32 zone_package_size;    /* Size of zone package (bytes) */
        uint32 zone_package_crc32;   /* CRC32 of zone package */
        uint8 update_required;       /* 0=Skip, 1=Update this zone */
        uint8 update_priority;       /* 0=Low, 1=Med, 2=High, 3=Critical */
        uint8 reserved[2];
    } zone_packages[8];              /* Max 8 zones */
    
    /* Installation Instructions */
    uint8 install_mode;              /* 1=Sequential, 2=Parallel, 3=Staged */
    uint16 max_install_time_sec;     /* Maximum installation time (seconds) */
    uint8 reboot_required;           /* 1=Reboot required after install */
    uint8 rollback_supported;        /* 1=Rollback supported */
    
    /* Security */
    uint8 signature_algorithm;       /* 1=RSA2048, 2=ECDSA256, etc */
    uint16 signature_size;           /* Size of signature (bytes) */
    uint8 signature[256];            /* Digital signature of package */
    
    /* Campaign Information */
    char campaign_id[32];            /* OTA Campaign ID */
    char campaign_name[64];          /* Campaign Name */
    uint8 campaign_priority;         /* 1=Low, 2=Medium, 3=High, 4=Critical */
    uint32 campaign_deadline;        /* Installation deadline (Unix timestamp) */
    
} Vehicle_Package_Metadata;

/* Total size: ~690 bytes (with Vehicle VCI matching fields) */

/* Vehicle Package Magic Number */
#define VEHICLE_PACKAGE_MAGIC       0x5650434B  /* "VPCK" */
```

---

### í•„ë“œë³„ ìƒì„¸ ì„¤ëª…

#### ğŸ”¹ Package Identification

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `magic_number` | uint32 | **Magic Number**: `0x5650434B` ("VPCK"), íŒ¨í‚¤ì§€ íƒ€ì… ì‹ë³„ |
| `metadata_version` | uint16 | ë©”íƒ€ë°ì´í„° êµ¬ì¡° ë²„ì „ (í˜„ì¬: 1) |
| `metadata_size` | uint16 | ì´ êµ¬ì¡°ì²´ì˜ í¬ê¸° (bytes) |

#### ğŸ”¹ Package Information

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|
| `package_id` | char[32] | ê³ ìœ  íŒ¨í‚¤ì§€ ID | `"VPKG_2024_001"` |
| `vehicle_sw_version` | char[16] | ë§ˆìŠ¤í„° SW ë²„ì „ | `"2.5.0"` |
| `package_total_size` | uint32 | ì „ì²´ íŒ¨í‚¤ì§€ í¬ê¸° (bytes) | `104857600` (100MB) |
| `package_crc32` | uint32 | ì „ì²´ íŒ¨í‚¤ì§€ CRC32 | `0xABCD1234` |
| `creation_timestamp` | uint32 | ìƒì„± ì‹œê° (Unix timestamp) | `1705132800` |

#### ğŸ”¹ Target Vehicle Identification

**Vehicle VCIì™€ ì •í™•íˆ ë§¤ì¹­ë˜ì–´ì•¼ í•©ë‹ˆë‹¤!**

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | VCI ë§¤ì¹­ |
|------|------|------|----------|
| `target_vin` | char[18] | ëŒ€ìƒ VIN (ë˜ëŠ” "*" for wildcard) | `Vehicle_VCI.vin` |
| `target_vehicle_model` | char[32] | ëŒ€ìƒ ëª¨ë¸ëª… | `Vehicle_VCI.vehicle_model` |
| `target_model_year` | uint16 | ëŒ€ìƒ ëª¨ë¸ ì—°ë„ (0=any) | `Vehicle_VCI.model_year` |

#### ğŸ”¹ Compatibility Criteria

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `target_model_years[8]` | uint16[] | ì ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ì—°ë„ (0=unused) |
| `target_vehicle_types[8]` | uint8[] | ì ìš© ê°€ëŠ¥í•œ ì°¨ëŸ‰ íƒ€ì… (0=unused) |
| `target_regions[8]` | uint8[] | ì ìš© ê°€ëŠ¥í•œ ì§€ì—­ (0=unused) |
| `min_vehicle_sw_version` | char[16] | ìµœì†Œ í˜„ì¬ SW ë²„ì „ |
| `required_architecture` | uint8 | í•„ìˆ˜ ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ (0x02=Zonal) |
| `required_num_zones` | uint8 | í•„ìˆ˜ Zone ìˆ˜ |

#### ğŸ”¹ Zone Package Information

ê° Zone Packageì— ëŒ€í•œ ì •ë³´ (ìµœëŒ€ 8ê°œ):

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `zone_id` | uint8 | Zone ID (1-7, 0=Central) |
| `zone_package_id` | char[32] | Zone Package ID |
| `zone_package_offset` | uint32 | Vehicle Package ë‚´ offset |
| `zone_package_size` | uint32 | Zone Package í¬ê¸° |
| `zone_package_crc32` | uint32 | Zone Package CRC32 |
| `update_required` | uint8 | 0=Skip, 1=Update |
| `update_priority` | uint8 | 0=Low, 1=Med, 2=High, 3=Critical |

#### ğŸ”¹ Installation Instructions

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | ê°€ëŠ¥í•œ ê°’ |
|------|------|------|-----------|
| `install_mode` | uint8 | ì„¤ì¹˜ ëª¨ë“œ | 1=Sequential, 2=Parallel, 3=Staged |
| `max_install_time_sec` | uint16 | ìµœëŒ€ ì„¤ì¹˜ ì‹œê°„ (ì´ˆ) | 3600 |
| `reboot_required` | uint8 | ì¬ë¶€íŒ… í•„ìš” ì—¬ë¶€ | 0=No, 1=Yes |
| `rollback_supported` | uint8 | Rollback ì§€ì› ì—¬ë¶€ | 0=No, 1=Yes |

#### ğŸ”¹ Security

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `signature_algorithm` | uint8 | ì„œëª… ì•Œê³ ë¦¬ì¦˜ (1=RSA2048, 2=ECDSA256) |
| `signature_size` | uint16 | ì„œëª… í¬ê¸° (bytes) |
| `signature[256]` | uint8[] | ë””ì§€í„¸ ì„œëª… (RSA/ECDSA) |

#### ğŸ”¹ Campaign Information

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `campaign_id` | char[32] | OTA ìº í˜ì¸ ID |
| `campaign_name` | char[64] | ìº í˜ì¸ëª… |
| `campaign_priority` | uint8 | ìº í˜ì¸ ìš°ì„ ìˆœìœ„ (1-4) |
| `campaign_deadline` | uint32 | ì„¤ì¹˜ ë§ˆê° ì‹œê° (Unix timestamp) |

---

### Vehicle Package Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vehicle Package Layout (Master)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Offset       Size        Content                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x0000       690 B       Vehicle Package Metadata           â”‚
â”‚                          - Magic: 0x5650434B                â”‚
â”‚                          - Target VIN/Model matching        â”‚
â”‚                          - Zone Package List                â”‚
â”‚                          - Master Signature                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0x02B2       Variable    Zone 1 Package                     â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                          â”‚ Zone 1 Metadata (800 B)      â”‚   â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚                          â”‚ ECU Package 1                â”‚   â”‚
â”‚                          â”‚  â”œâ”€ ECU Metadata (512 B)     â”‚   â”‚
â”‚                          â”‚  â”œâ”€ Main SW Binary           â”‚   â”‚
â”‚                          â”‚  â””â”€ Add-on Binaries (opt)    â”‚   â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚                          â”‚ ECU Package 2                â”‚   â”‚
â”‚                          â”‚  â””â”€ ...                      â”‚   â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...          Variable    Zone 2 Package                     â”‚
â”‚                          (Same structure as Zone 1)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...          Variable    Zone N Package                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ End          256 B       Master Signature (RSA/ECDSA)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Level 3-2: Zone Package Metadata

### ê°œë…

ê° Zoneì— ë°°í¬ë˜ëŠ” **Zoneë³„ ë…ë¦½ íŒ¨í‚¤ì§€**ë¡œ, Zone ë‚´ ECUë“¤ì˜ ì—…ë°ì´íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

```c
/**
 * \brief Zone Package Metadata
 * 
 * Zone-specific package for a zonal gateway
 * Generated by: VMG Server (Zone Integration Team)
 * Storage: Embedded in Vehicle Package, extracted by ZGW
 */
typedef struct
{
    /* Package Identification */
    uint32 magic_number;             /* Magic: 0x5A50434B ("ZPCK") */
    uint16 metadata_version;         /* Metadata structure version */
    uint16 metadata_size;            /* Size of this structure */
    
    /* Zone Information */
    uint8 zone_id;                   /* Zone ID (1-7, 0=Central) */
    char zone_package_id[32];        /* Package ID (e.g., "ZPKG_Z1_001") */
    char zone_sw_version[16];        /* Zone SW Version */
    uint32 zone_package_size;        /* Total zone package size */
    uint32 zone_package_crc32;       /* CRC32 of zone package */
    
    /* Target Zonal Gateway */
    char target_zgw_id[16];          /* Target ZGW (e.g., "ZGW_01") */
    char target_zgw_sw_version[16];  /* Required ZGW SW version */
    
    /* ECU Package Information */
    uint8 number_of_ecus;            /* Number of ECUs in this zone (1-16) */
    struct {
        char target_ecu_id[16];      /* Target ECU ID (e.g., "ECU_011") */
        char ecu_package_id[32];     /* ECU Package ID */
        char current_sw_version[8];  /* Required current SW version */
        char new_sw_version[8];      /* New SW version after update */
        uint32 ecu_package_offset;   /* Offset in zone package (bytes) */
        uint32 ecu_package_size;     /* Size of ECU package (bytes) */
        uint32 ecu_package_crc32;    /* CRC32 of ECU package */
        uint8 update_sequence;       /* Update order (0=first, 255=last) */
        uint8 critical;              /* 1=Critical (must succeed) */
        uint8 has_addons;            /* 1=Contains add-on modules */
        uint8 reserved;
    } ecu_packages[16];              /* Max 16 ECUs per zone */
    
    /* Zone-Specific Settings */
    uint8 zone_update_mode;          /* 1=Sequential, 2=Parallel */
    uint16 zone_max_time_sec;        /* Maximum time for this zone */
    uint8 zone_rollback_enabled;     /* 1=Zone-level rollback enabled */
    uint8 reserved[3];
    
} Zone_Package_Metadata;

/* Total size: ~800 bytes */

/* Zone Package Magic Number */
#define ZONE_PACKAGE_MAGIC          0x5A50434B  /* "ZPCK" */
```

---

### í•„ë“œë³„ ìƒì„¸ ì„¤ëª…

#### ğŸ”¹ Zone Information

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|
| `zone_id` | uint8 | Zone ID | 1-7 (Zone 1-7), 0 (Central) |
| `zone_package_id` | char[32] | Zone Package ID | `"ZPKG_Z1_001"` |
| `zone_sw_version` | char[16] | Zone í†µí•© SW ë²„ì „ | `"1.5.0"` |
| `zone_package_size` | uint32 | Zone Package ì „ì²´ í¬ê¸° | `52428800` (50MB) |
| `zone_package_crc32` | uint32 | Zone Package CRC32 | `0x12345678` |

#### ğŸ”¹ Target Zonal Gateway

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `target_zgw_id` | char[16] | ëŒ€ìƒ ZGW ID (e.g., `"ZGW_01"`) |
| `target_zgw_sw_version` | char[16] | í•„ìˆ˜ ZGW SW ë²„ì „ |

#### ğŸ”¹ ECU Package Information

ê° ECU Packageì— ëŒ€í•œ ì •ë³´ (ìµœëŒ€ 16ê°œ):

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `target_ecu_id` | char[16] | ëŒ€ìƒ ECU ID (e.g., `"ECU_011"`) |
| `ecu_package_id` | char[32] | ECU Package ID |
| `current_sw_version` | char[8] | í•„ìˆ˜ í˜„ì¬ SW ë²„ì „ |
| `new_sw_version` | char[8] | ì—…ë°ì´íŠ¸ í›„ SW ë²„ì „ |
| `ecu_package_offset` | uint32 | Zone Package ë‚´ offset |
| `ecu_package_size` | uint32 | ECU Package í¬ê¸° |
| `ecu_package_crc32` | uint32 | ECU Package CRC32 |
| `update_sequence` | uint8 | ì—…ë°ì´íŠ¸ ìˆœì„œ (0=first) |
| `critical` | uint8 | 1=Critical (ì‹¤íŒ¨ ì‹œ ì „ì²´ ì¤‘ë‹¨) |
| `has_addons` | uint8 | 1=Add-on ëª¨ë“ˆ í¬í•¨ |

---

## Level 3-3: ECU Package Metadata

### ê°œë…

ê°œë³„ ECUì˜ ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨í‚¤ì§€ë¡œ, **Main SW + Add-on ëª¨ë“ˆ**ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

```c
/**
 * \brief ECU Package Metadata
 * 
 * Individual ECU software package (may contain add-on modules)
 * Generated by: VMG Server (ECU Development Team)
 * Storage: Embedded in Zone Package, extracted by Zone ECU
 */
typedef struct
{
    /* Package Identification */
    uint32 magic_number;             /* Magic: 0x4550434B ("EPCK") */
    uint16 metadata_version;         /* Metadata structure version */
    uint16 metadata_size;            /* Size of this structure */
    
    /* ECU Information */
    char ecu_id[16];                 /* ECU ID (e.g., "ECU_011") */
    char ecu_package_id[32];         /* Package ID */
    char sw_version[16];             /* SW Version */
    uint32 ecu_package_size;         /* Total ECU package size */
    uint32 ecu_package_crc32;        /* CRC32 of ECU package */
    
    /* Main Software */
    char main_sw_version[16];        /* Main SW version */
    uint32 main_sw_offset;           /* Offset in ECU package (bytes) */
    uint32 main_sw_size;             /* Size of main SW (bytes) */
    uint32 main_sw_crc32;            /* CRC32 of main SW */
    uint32 flash_target_address;     /* Target flash address (e.g., 0xA0001000) */
    uint32 flash_size_required;      /* Required flash space (bytes) */
    
    /* Add-on Modules (Optional) */
    uint8 number_of_addons;          /* Number of add-on modules (0-4) */
    struct {
        char addon_id[16];           /* Add-on ID (e.g., "CAM_MODULE") */
        char addon_version[8];       /* Add-on version */
        uint32 addon_offset;         /* Offset in ECU package (bytes) */
        uint32 addon_size;           /* Size of add-on (bytes) */
        uint32 addon_crc32;          /* CRC32 of add-on */
        uint32 addon_flash_address;  /* Target flash address */
        uint8 addon_critical;        /* 1=Critical, 0=Optional */
        uint8 reserved[3];
    } addon_modules[4];              /* Max 4 add-ons per ECU */
    
    /* Installation */
    uint8 install_order;             /* Installation order within zone */
    uint8 requires_bootloader;       /* 1=Requires bootloader mode */
    uint16 install_time_sec;         /* Expected installation time */
    
    /* Compatibility */
    char hw_version_required[8];     /* Required HW version */
    uint32 min_memory_kb;            /* Minimum free memory required */
    
} ECU_Package_Metadata;

/* Total size: ~512 bytes */

/* ECU Package Magic Number */
#define ECU_PACKAGE_MAGIC           0x4550434B  /* "EPCK" */
```

---

### Add-on Module ì§€ì›

#### ê°œë…

ECUì— ë¶€ì°©ëœ **ì¶”ê°€ í•˜ë“œì›¨ì–´ ëª¨ë“ˆ**ì˜ íŒì›¨ì–´ë¥¼ í•¨ê»˜ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

#### ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤

```
ECU_011 (Door Control ECU):
â”œâ”€ Main SW: Door control logic (2MB)
â”œâ”€ Add-on 1: Camera Module firmware (1MB)
â””â”€ Add-on 2: Fingerprint Sensor firmware (512KB)

ECU_901 (ADAS ECU):
â”œâ”€ Main SW: ADAS processing (5MB)
â”œâ”€ Add-on 1: Front Camera firmware (2MB)
â”œâ”€ Add-on 2: Side Radar firmware (1MB)
â””â”€ Add-on 3: LiDAR firmware (3MB)
```

#### Add-on í•„ë“œ ì„¤ëª…

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `addon_id` | char[16] | Add-on ëª¨ë“ˆ ID |
| `addon_version` | char[8] | Add-on ë²„ì „ |
| `addon_offset` | uint32 | ECU Package ë‚´ offset |
| `addon_size` | uint32 | Add-on ë°”ì´ë„ˆë¦¬ í¬ê¸° |
| `addon_crc32` | uint32 | Add-on CRC32 |
| `addon_flash_address` | uint32 | Flash ì €ì¥ ì£¼ì†Œ |
| `addon_critical` | uint8 | 1=í•„ìˆ˜, 0=ì„ íƒì  |

---

## Level 4: Readiness Metadata

### ê°œë…

OTA ì—…ë°ì´íŠ¸ **ì‚¬ì „ ê²€ì¦**ì„ ìœ„í•œ ì‹¤ì‹œê°„ ìƒíƒœ ì •ë³´ì…ë‹ˆë‹¤.

### ë°ì´í„° êµ¬ì¡°

```c
/**
 * \brief Readiness Information
 * 
 * Runtime data collected from ECUs for OTA readiness validation
 * Storage: RAM (temporary), 27 bytes
 * Collection: UDP Broadcast/Unicast (Port 13400)
 */
typedef struct
{
    char ecu_id[16];            /* ECU ID (e.g., "ECU_011") */
    uint8 battery_voltage;      /* Battery voltage (0.1V units, e.g., 125 = 12.5V) */
    uint8 free_memory_percent;  /* Free memory (%) */
    uint8 engine_running;       /* 1=Running, 0=Off */
    uint8 vehicle_speed_kmh;    /* Vehicle speed (km/h) */
    uint8 door_status;          /* Bit field: Bit0=FL, Bit1=FR, Bit2=RL, Bit3=RR */
    uint8 error_count;          /* Active DTC count */
    uint8 temperature_c;        /* ECU temperature (Â°C, signed offset +40) */
    uint8 ready_status;         /* 0x00=Not Ready, 0xFF=Ready */
    uint16 reserved;            /* Reserved for future use */
} Readiness_Info;

/* Total size: 27 bytes */
```

---

### Readiness Criteria (ì¤€ë¹„ ì¡°ê±´)

OTA ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ìœ„í•œ **í•„ìˆ˜ ì¡°ê±´**:

| ì¡°ê±´ | í•„ë“œ | ê¸°ì¤€ | ì´ìœ  |
|------|------|------|------|
| **ë°°í„°ë¦¬ ì „ì••** | `battery_voltage` | â‰¥ 120 (12.0V) | ì—…ë°ì´íŠ¸ ì¤‘ ì „ì› ì°¨ë‹¨ ë°©ì§€ |
| **ì—¬ìœ  ë©”ëª¨ë¦¬** | `free_memory_percent` | â‰¥ 30% | íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜ ê³µê°„ |
| **ì—”ì§„ ìƒíƒœ** | `engine_running` | 0 (Off) | ì•ˆì „ì„ ìœ„í•´ ì—”ì§„ êº¼ì§ í•„ìš” |
| **ì°¨ëŸ‰ ì†ë„** | `vehicle_speed_kmh` | 0 (Stopped) | ì£¼í–‰ ì¤‘ ì—…ë°ì´íŠ¸ ê¸ˆì§€ |
| **ë„ì–´ ìƒíƒœ** | `door_status` | 0x00 (All closed) | ëª¨ë“  ë„ì–´ ë‹«í˜ |
| **ì˜¤ë¥˜ ê°œìˆ˜** | `error_count` | 0 | í™œì„± DTC ì—†ìŒ |
| **ECU ì˜¨ë„** | `temperature_c` | 40-100Â°C | ê³¼ì—´ ë°©ì§€ (offset +40) |

---

### UDP íŒ¨í‚· êµ¬ì¡°

#### Request (ZGW â†’ Zone ECUs)

```
Protocol: UDP Broadcast
Destination: 192.168.1.255:13400
Payload: [0x52, 0x44, 0x59, 0x3F]  // "RDY?" magic number
Size: 4 bytes
```

#### Response (Zone ECU â†’ ZGW)

```
Protocol: UDP Unicast
Destination: ZGW IP:13400
Payload: Readiness_Info (27 bytes)
Total Size: 27 bytes
```

---

### Readiness ê²€ì¦ ë¡œì§

```c
/**
 * \brief Validate Readiness for OTA
 * 
 * \param info Readiness information from ECU
 * \return TRUE if ready, FALSE otherwise
 */
boolean Validate_Readiness(Readiness_Info *info)
{
    /* Check battery voltage (â‰¥ 12.0V) */
    if (info->battery_voltage < 120) {
        sendUARTMessage("[ERROR] Low battery voltage\r\n", 30);
        return FALSE;
    }
    
    /* Check free memory (â‰¥ 30%) */
    if (info->free_memory_percent < 30) {
        sendUARTMessage("[ERROR] Insufficient memory\r\n", 30);
        return FALSE;
    }
    
    /* Check engine status (must be off) */
    if (info->engine_running != 0) {
        sendUARTMessage("[ERROR] Engine must be off\r\n", 29);
        return FALSE;
    }
    
    /* Check vehicle speed (must be stopped) */
    if (info->vehicle_speed_kmh != 0) {
        sendUARTMessage("[ERROR] Vehicle must be stopped\r\n", 34);
        return FALSE;
    }
    
    /* Check door status (all closed) */
    if (info->door_status != 0x00) {
        sendUARTMessage("[ERROR] Doors must be closed\r\n", 31);
        return FALSE;
    }
    
    /* Check error count (no active DTCs) */
    if (info->error_count > 0) {
        char log[64];
        sprintf(log, "[ERROR] Active DTCs: %u\r\n", info->error_count);
        sendUARTMessage(log, strlen(log));
        return FALSE;
    }
    
    /* Check temperature (40-100Â°C, offset +40) */
    if (info->temperature_c < 40 || info->temperature_c > 140) {
        sendUARTMessage("[ERROR] ECU temperature out of range\r\n", 40);
        return FALSE;
    }
    
    /* Check ready status */
    if (info->ready_status != 0xFF) {
        sendUARTMessage("[ERROR] ECU not ready\r\n", 24);
        return FALSE;
    }
    
    sendUARTMessage("[OK] ECU ready for OTA\r\n", 25);
    return TRUE;
}
```

---

## Package Generation Flow

### Server-side Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            VMG Server Package Generation Pipeline           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: ECU Package Creation (ECU Development Team)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  - ECU_011.elf (Main SW binary)
        - CAM_MODULE.bin (Add-on 1)
        - RADAR_MODULE.bin (Add-on 2)

Process:
  1. Parse ELF header and extract executable sections
  2. Calculate CRC32 for each binary
  3. Create ECU_Package_Metadata
     - Set magic_number = 0x4550434B ("EPCK")
     - Set ecu_id = "ECU_011"
     - Set main_sw_offset, size, crc32
     - Set addon_modules[0] (CAM_MODULE)
     - Set addon_modules[1] (RADAR_MODULE)
  4. Assemble binary package
  
Output: ECU_011_Package.bin (512B metadata + binaries)
        - ECU_Package_Metadata (512 bytes)
        - Main SW Binary (e.g., 2MB)
        - Add-on 1 Binary (e.g., 1MB)
        - Add-on 2 Binary (e.g., 512KB)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 2: Zone Package Creation (Zone Integration Team)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  - ECU_011_Package.bin
        - ECU_012_Package.bin
        - ECU_013_Package.bin

Process:
  1. Load all ECU packages for Zone 1
  2. Calculate offsets for each ECU package
  3. Create Zone_Package_Metadata
     - Set magic_number = 0x5A50434B ("ZPCK")
     - Set zone_id = 1
     - Set ecu_packages[0] (ECU_011: offset, size, crc32)
     - Set ecu_packages[1] (ECU_012: offset, size, crc32)
     - Set ecu_packages[2] (ECU_013: offset, size, crc32)
  4. Calculate Zone Package CRC32
  5. Assemble Zone Package
  
Output: Zone1_Package.bin (800B metadata + ECU packages)
        - Zone_Package_Metadata (800 bytes)
        - ECU_011_Package.bin
        - ECU_012_Package.bin
        - ECU_013_Package.bin

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 3: Vehicle Package Creation (Vehicle Integration Team)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Input:  - Zone1_Package.bin
        - Zone2_Package.bin
        - Zone3_Package.bin
        - Vehicle_VCI (from database)

Process:
  1. Load all Zone packages
  2. Read Vehicle VCI for target vehicle
  3. Create Vehicle_Package_Metadata
     - Set magic_number = 0x5650434B ("VPCK")
     - Set target_vin from Vehicle_VCI.vin
     - Set target_vehicle_model from Vehicle_VCI.vehicle_model
     - Set required_num_zones from Vehicle_VCI.number_of_zones
     - Set zone_packages[0] (Zone 1: offset, size, crc32)
     - Set zone_packages[1] (Zone 2: offset, size, crc32)
     - Set zone_packages[2] (Zone 3: offset, size, crc32)
  4. Calculate Vehicle Package CRC32
  5. Generate RSA/ECDSA signature
  6. Assemble Vehicle Package
  
Output: Vehicle_Package.bin (690B metadata + Zone packages + signature)
        - Vehicle_Package_Metadata (690 bytes)
        - Zone1_Package.bin
        - Zone2_Package.bin
        - Zone3_Package.bin
        - Digital Signature (256 bytes)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 4: Deployment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Storage: VMG Server â†’ Cloud Storage (S3, Azure Blob, etc)
Delivery: VMG Server â†’ Vehicle (OTA via 4G/5G or Workshop via USB)
```

---

## OTA Deployment Sequence

### ì „ì²´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VMG    â”‚       â”‚   ZGW    â”‚       â”‚ Zone ECU â”‚       â”‚  Add-on  â”‚
â”‚  Server  â”‚       â”‚          â”‚       â”‚          â”‚       â”‚  Module  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚ â‘  Vehicle Packageâ”‚                  â”‚                  â”‚
     â”‚ (All Zones)      â”‚                  â”‚                  â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚
     â”‚   TCP Download   â”‚                  â”‚                  â”‚
     â”‚   DoIP 0x34/0x36 â”‚                  â”‚                  â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚              â‘¡ Parse Vehicle Pkg   â”‚                  â”‚
     â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                  â”‚
     â”‚                  â”‚ - Verify    â”‚    â”‚                  â”‚
     â”‚                  â”‚   Magic     â”‚    â”‚                  â”‚
     â”‚                  â”‚ - Check VIN â”‚    â”‚                  â”‚
     â”‚                  â”‚ - Validate  â”‚    â”‚                  â”‚
     â”‚                  â”‚   CRC32     â”‚    â”‚                  â”‚
     â”‚                  â”‚ - Extract   â”‚    â”‚                  â”‚
     â”‚                  â”‚   Zone Pkgs â”‚    â”‚                  â”‚
     â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚ â‘¢ Zone Package  â”‚                  â”‚
     â”‚                  â”‚    (Zone 1)      â”‚                  â”‚
     â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
     â”‚                  â”‚   TCP/CAN-FD     â”‚                  â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚              â‘£ Parse Zone Pkg     â”‚
     â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚                  â”‚                  â”‚ - Verify    â”‚    â”‚
     â”‚                  â”‚                  â”‚   Magic     â”‚    â”‚
     â”‚                  â”‚                  â”‚ - Check     â”‚    â”‚
     â”‚                  â”‚                  â”‚   ECU ID    â”‚    â”‚
     â”‚                  â”‚                  â”‚ - Validate  â”‚    â”‚
     â”‚                  â”‚                  â”‚   CRC32     â”‚    â”‚
     â”‚                  â”‚                  â”‚ - Extract   â”‚    â”‚
     â”‚                  â”‚                  â”‚   ECU Pkgs  â”‚    â”‚
     â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚                  â”‚ â‘¤ ECU Package   â”‚
     â”‚                  â”‚                  â”‚    (with add-ons)â”‚
     â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                  â”‚                  â”‚   Internal Bus   â”‚
     â”‚                  â”‚                  â”‚   (SPI/I2C)      â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚              â‘¥ Flash Main SW       â”‚
     â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
     â”‚                  â”‚                  â”‚ Erase   â”‚        â”‚
     â”‚                  â”‚                  â”‚ Write   â”‚        â”‚
     â”‚                  â”‚                  â”‚ Verify  â”‚        â”‚
     â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚                  â”‚ â‘¦ Flash Add-on  â”‚
     â”‚                  â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”
     â”‚                  â”‚                  â”‚                  â”‚ CAMâ”‚
     â”‚                  â”‚                  â”‚                  â”‚<â”€â”€â”€â”˜
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚                  â”‚ â‘§ Verify CRC    â”‚
     â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                  â”‚                  â”‚ CRC Main SW     â”‚
     â”‚                  â”‚                  â”‚ CRC Add-ons     â”‚
     â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚                  â”‚ â‘¨ Zone Complete  â”‚                  â”‚
     â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
     â”‚                  â”‚   (Success/Fail) â”‚                  â”‚
     â”‚                  â”‚                  â”‚                  â”‚
     â”‚ â‘© Vehicle Update â”‚                  â”‚                  â”‚
     â”‚    Status        â”‚                  â”‚                  â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚                  â”‚
     â”‚   (All Zones)    â”‚                  â”‚                  â”‚
     â”‚                  â”‚                  â”‚                  â”‚
```

---

### ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

#### â‘  VMG â†’ ZGW: Vehicle Package ì „ì†¡

```c
/* UDS Download Sequence */
1. UDS 0x34 (RequestDownload)
   - Address: External Flash (0x64000000)
   - Size: Vehicle Package total size
   
2. UDS 0x36 (TransferData)
   - Block size: 4096 bytes
   - Transfer in chunks
   - Progress: 0% â†’ 100%
   
3. UDS 0x37 (RequestTransferExit)
   - Finalize download
```

#### â‘¡ ZGW: Vehicle Package íŒŒì‹±

```c
/* Validation Steps */
1. Check magic_number == 0x5650434B
2. Verify target_vin matches Vehicle_VCI.vin
3. Verify target_vehicle_model matches Vehicle_VCI.vehicle_model
4. Validate package_crc32
5. Verify RSA/ECDSA signature
6. Extract Zone Packages using zone_package_offset
```

#### â‘¢ ZGW â†’ Zone ECU: Zone Package ì „ì†¡

```c
/* Zone Package Relay */
- Protocol: TCP or CAN-FD
- Target: Zone ECU IP or CAN ID
- Size: zone_package_size
- CRC: zone_package_crc32
```

#### â‘£ Zone ECU: Zone Package íŒŒì‹±

```c
/* Validation Steps */
1. Check magic_number == 0x5A50434B
2. Verify zone_id matches local zone
3. Find own ECU ID in ecu_packages[] array
4. Validate zone_package_crc32
5. Extract ECU Package using ecu_package_offset
```

#### â‘¤ Zone ECU â†’ Add-on: ECU Package ì „ì†¡

```c
/* Add-on Module Communication */
- Protocol: SPI, I2C, or internal bus
- Target: Add-on module
- Size: addon_size
- CRC: addon_crc32
```

#### â‘¥-â‘¦ Flash ì“°ê¸°

```c
/* Flash Programming Sequence */
1. Erase target Flash sectors
2. Write Main SW to flash_target_address
3. Write Add-on binaries to addon_flash_address
4. Refresh watchdog periodically
```

#### â‘§ CRC ê²€ì¦

```c
/* Post-Flash Verification */
1. Calculate CRC32 of flashed Main SW
2. Compare with main_sw_crc32 from metadata
3. Calculate CRC32 of flashed Add-ons
4. Compare with addon_crc32 from metadata
5. If mismatch â†’ Trigger rollback
```

#### â‘¨-â‘© ìƒíƒœ ë³´ê³ 

```c
/* Status Reporting */
Zone ECU â†’ ZGW:
  - Status: Success/Fail
  - New SW Version
  - Error codes (if any)

ZGW â†’ VMG:
  - Overall status
  - Zone-by-zone results
  - Timestamp
```

---

## ì°¸ì¡° ë¬¸ì„œ

- **VCI_information.md**: Vehicle ë° ECU VCI êµ¬ì¡°
- **memory_map.md**: AURIX TC375 ë©”ëª¨ë¦¬ ë§µ
- **ISO 14229-1**: Unified Diagnostic Services (UDS)
- **ISO 13400**: Diagnostic communication over IP (DoIP)

---

**ë¬¸ì„œ ì¢…ë£Œ**


